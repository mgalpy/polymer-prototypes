<!doctype html>
<html>

<head>
    <title>Lion Brand Survey</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <script src="https://www.polymer-project.org/components/webcomponentsjs/webcomponents.js"></script>

    <link rel="import" href="https://www.polymer-project.org/components/swipeable-card/swipeable-card.html">
    <link rel="import" href="https://www.polymer-project.org/components/paper-tabs/paper-tabs.html">
    <link rel="import" href="https://www.polymer-project.org/components/core-pages/core-pages.html">
    <link rel="import" href="https://www.polymer-project.org/components/core-toolbar/core-toolbar.html">
    <link rel="import" href="https://www.polymer-project.org/components/paper-toast/paper-toast.html">
    <link href="https://www.polymer-project.org/components/core-animated-pages/core-animated-pages.html" rel="import">
    <link href="https://www.polymer-project.org/components/core-animated-pages/transitions/slide-from-right.html" rel="import">
    <link href="https://www.polymer-project.org/components/paper-shadow/paper-shadow.html" rel="import">
    <link href="https://www.polymer-project.org/components/paper-button/paper-button.html" rel="import">
    <link href="https://www.polymer-project.org/components/paper-dialog/paper-dialog.html" rel="import">
    <link href="https://www.polymer-project.org/components/paper-dialog/paper-action-dialog.html" rel="import">
    <link rel="import" href="https://www.polymer-project.org/components/core-drag-drop/core-drag-drop.html">
    <link href="https://www.polymer-project.org/components/paper-fab/paper-fab.html" rel="import">

    <style>
    * {
        /*overflow: none;*/
        
        cursor: pointer;
    }
    ::selection {
        color: transparent;
        background: transparent;
    }
    body {
        background-color: #eee;
        font-family: Roboto;
    }
    .deck {
        padding: 0 5px;
        margin: 0 5px;
        float: left;
        background: #eee;
        -webkit-user-select: none;
        -moz-user-select: none;
    }
    swipeable-card {
        /*height: 200px;*/
        
        height: auto;
        width: 240px;
        /*        height: 150px;
        width: 180px;*/
        
        margin: 20px auto;
        padding: 30px;
    }
    paper-tab {
        text-align: center;
        font-size: 16px;
        font-weight: 300;
    }
    paper-tabs::shadow #selectionBar {
        background-color: #4285f4;
    }
    paper-tabs paper-tab::shadow #ink {
        color: #4285f4;
    }
    paper-button.colored {
        color: #4285f4;
        float: right;
    }
    paper-fab {
        background: #5677fc;
        /*position: absolute;*/
        /*right: 40px;*/
        
        transition: transform 500ms cubic-bezier(0.4, 0, 0.2, 1) 500ms, background-color 500ms cubic-bezier(0.4, 0, 0.2, 1);
        -webkit-transition: -webkit-transform 500ms cubic-bezier(0.4, 0, 0.2, 1) 500ms, background-color 500ms cubic-bezier(0.4, 0, 0.2, 1);
        -webkit-transform: scale(0);
        transform: scale(0);
        -webkit-transform-origin: 50% 50%;
        transform-origin: 50% 50%;
    }
    paper-fab[showing] {
        -webkit-transform: none;
        transform: none;
    }
    .deckTitle {
        text-transform: uppercase;
        text-align: center;
        background-color: transparent;
        box-shadow: none;
    }
    h1 {
        font-size: 14px;
        margin: 0;
        padding: 0;
        text-transform: uppercase;
        text-align: center;
    }
    h2 {
        text-align: center;
        margin: 0;
        padding: 0;
        font-size: 12px;
        font-weight: 500;
        color: #777;
    }
    p {
        font-size: 14px;
    }
    .box {
        display: inline-block;
        margin: 16px;
        padding: 16px;
        position: relative;
        width: 200px;
        height: auto;
        min-height: 160px;
        box-shadow: 0px 2px 5px #ccc;
        color: #333;
        background-color: white;
        cursor: pointer;
    }
    .dropped {
        position: absolute;
        border: 1px solid black;
        width: 5px;
        height: 5px;
        cursor: pointer;
    }
    </style>

</head>

<body fullbleed unresolved>
    <core-toolbar>

        <paper-icon-button icon="menu"></paper-icon-button>
        <div flex style="font-size:24px;font-weight:300;white-space:nowrap">Lion Survey</div>
        <paper-icon-button icon="search"></paper-icon-button>
        <paper-icon-button icon="more-vert"></paper-icon-button>


    </core-toolbar>
    <paper-tabs selected="1">

        <paper-tab>Instructions</paper-tab>
        <paper-tab>Step 1</paper-tab>
        <paper-tab>Step 2</paper-tab>
        <paper-tab>Step 3</paper-tab>
        <paper-tab>Step 4</paper-tab>

    </paper-tabs>

    <core-animated-pages selected="{{selected}}" transitions="slide-from-right">

        <div horizontal center-justified layout>

            <paper-action-dialog heading="Survey Instructions" transition="core-transition-center" id="dialog" backdrop autoCloseDisabled layered="false">
                <p>Looking at the following 12 cards, please select 6 that you feel do not fit your brand.</p>
                <paper-button dismissive>More Info...</paper-button>
                <paper-button affirmative>Decline</paper-button>
                <paper-button affirmative autofocus>Accept</paper-button>
            </paper-action-dialog>



            <div id="intro" class="deck">

                <swipeable-card>
                    <p>Welcome!</p>
                    <p> Looking at the following 12 cards, please select 6 that you feel do not fit your brand. </p>
                    <p> Swipe this card away or press Start when you&rsquo;re ready to begin.</p>
                    <p style="padding-bottom:2px;">
                        <paper-button affirmative autofocus class="colored" onclick="showDialog('dialog')">Start</paper-button>
                    </p>
                </swipeable-card>

            </div>
        </div>

        <div horizontal center-justified layout>

            <div id="cards1" class="deck">
                <swipeable-card disableSwipe="true" class="deckTitle">First deck</swipeable-card>
                <swipeable-card id="caregiver-being">
                    <h1>I am...</h1>
                    <p>Kind, compassionate, nurturing, tender, gentle, affectionate, reassuring, dependable, selfless</p>
                </swipeable-card>
                <swipeable-card id="ruler-being">
                    <h1>I am...</h1>
                    <p>Powerful, successful, prosperous, an orderly, businesslike, methodical, purposeful, professional, consistent, disciplined, stable, hierarchical</p>
                </swipeable-card>
                <swipeable-card id="innocent-being">
                    <h1>I am...</h1>
                    <p>Traditional, honest, uncomplicated, predictable, childlike, nostalgic, care free, good, idealistic, optimistic, always seeing the good</p>
                </swipeable-card>

            </div>

            <div id="cards2" class="deck">
                <swipeable-card disableSwipe="true" class="deckTitle">Second deck</swipeable-card>
                <swipeable-card id="explorer-being">
                    <h1>I am...</h1>
                    <p>Curious, rugged, sturdy, worldly, independent, introspective, uncontained, travelled, exotic, dynamic, experience-hungry</p>
                </swipeable-card>
                <swipeable-card id="sage-being">
                    <h1>I am...</h1>
                    <p>Expert, knowledgeable, wise, intelligent, analytical, opinionated, introspective, curious, educational, objective, critical, philosophical</p>
                </swipeable-card>
                <swipeable-card id="magician-being">
                    <h1>I am...</h1>
                    <p>Intuitive, enchanting, awe-inspiring, transcendent, transformative, futuristic, cutting edge, manipulative, awakened, instinctive</p>
                </swipeable-card>

            </div>

            <div id="cards3" class="deck">
                <swipeable-card disableSwipe="true" class="deckTitle">Third deck</swipeable-card>
                <swipeable-card id="outlaw-being">
                    <h1>I am...</h1>
                    <p>Provocative, defiant, shocking, outrageous, maverick, rebellious, taboo, non-conformist, counter-cultural, liberated</p>
                </swipeable-card>
                <swipeable-card id="hero-being">
                    <h1>I am...</h1>
                    <p>Courageous, bold, moral, strong, magnetic, confident, modest, stoic, tenacious, disciplined, dutiful, skilled</p>
                </swipeable-card>
                <swipeable-card id="lover-being">
                    <h1>I am...</h1>
                    <p>Passionate, sexy, erotic, beautiful, romantic, intimate, playful, sensual, affectionate, attractive, vital, radiant, tactile, discerning</p>
                </swipeable-card>

            </div>

            <div id="cards4" class="deck">
                <swipeable-card disableSwipe="true" class="deckTitle">Fourth deck</swipeable-card>
                <swipeable-card id="regular-being">
                    <h1>I am...</h1>
                    <p>Down to earth, inclusive, friendly, sensible, honest, straight forward, reliable, reassuring, genuine, grounded, egalitarian</p>
                </swipeable-card>
                <swipeable-card id="jester-being">
                    <h1>I am...</h1>
                    <p>Fun, quirky, humorous, satirical, light-hearted, mischievous, spontaneous, unpredictable, unselfconscious</p>
                </swipeable-card>
                <swipeable-card id="creator-being">
                    <h1>I am...</h1>
                    <p>Creative, colourful, imaginative, expressive, innovative, inventive, inspiring, colourful, alternative, constructed, visionary</p>
                </swipeable-card>

            </div>

            <div id="discard" class="deck">
                <swipeable-card disableSwipe="true" class="deckTitle">Discard pile</swipeable-card>
            </div>

            <paper-fab icon="arrow-forward" hidden title="arrow-forward" id="fab-1" onclick="next()"></paper-fab>

        </div>

        <div>

            <core-drag-drop></core-drag-drop>

            <div horizontal center-justified layout>
                <div id="drop" class="box" draggable="false"></div>
                <div id="drop" class="box" draggable="false"></div>
                <div id="drop" class="box" draggable="false"></div>
            </div>

            <br>
            <br>

            <hr style="1px dotted silver;">

            <div horizontal center-justified layout>
                <div id="being-choice-1" class="box" draggable="false">
                    <h1>I am...</h1>
                    <p>default</p>
                </div>
                <div id="being-choice-2" class="box" draggable="false">
                    <h1>I am...</h1>
                    <p>default</p>
                </div>
                <div id="being-choice-3" class="box" draggable="false">
                    <h1>I am...</h1>
                    <p>default</p>
                </div>
                <div id="being-choice-4" class="box" draggable="false">
                    <h1>I am...</h1>
                    <p>default</p>
                </div>
                <div id="being-choice-5" class="box" draggable="false">
                    <h1>I am...</h1>
                    <p>default</p>
                </div>
                <div id="being-choice-6" class="box" draggable="false">
                    <h1>I am...</h1>
                    <p>default</p>
                </div>
            </div>

        </div>

        <div horizontal center-justified layout>
            <div id="cards7" class="deck">

                <swipeable-card>Page 3</swipeable-card>
                <swipeable-card>This is 2!</swipeable-card>
                <swipeable-card>Howdy, I'm 3.</swipeable-card>

            </div>
        </div>

        <div horizontal center-justified layout>
            <div id="cards8" class="deck">

                <swipeable-card>Page 4</swipeable-card>
                <swipeable-card>This is 2!</swipeable-card>
                <swipeable-card>Howdy, I'm 3.</swipeable-card>

            </div>
        </div>
    </core-animated-pages>

    <script>
    var tabs = document.querySelector('paper-tabs');
    var pages = document.querySelector('core-animated-pages');

    tabs.addEventListener('core-select', function() {
        pages.selected = tabs.selected;
    });

    var decks = document.getElementsByTagName('div');
    var x = 0;

    while (x < decks.length) {
        if ((decks[x].id.indexOf("cards")) == 0) {
            addCardListener(decks[x].id);
        }
        x++;
    }

    function addCardListener(name) {
        document.querySelector('#' + name).addEventListener('swipeable-card-swipe-away', function(e) {
            if (document.querySelector('#discard').children.length >= 7) {
                e.target.parentNode.removeChild(e.target); // removes this card
                document.querySelector('#' + name).appendChild(e.target); // puts this card back
                setTimeout(function() {
                    e.target.style.opacity = 1; // set opacity back to 1 (default)
                    // set it's position and location back to default (and in webkit-based browsers)
                    e.target.style.transform = "translate3d(0px, 0px, 0px) rotate(0deg)";
                    e.target.style.webkitTransform = "translate3d(0px, 0px, 0px) rotate(0deg)";
                }, 10);
            } else if (document.querySelector('#discard').children.length < 7) {
                console.log(document.querySelector('#discard').children.length);
                if (!e.target.swiped) {
                    e.target.parentNode.removeChild(e.target); // removes this card
                    // document.querySelector('#' + name).appendChild(e.target); // adds this card to the end of the set of cards
                    // if (name == "cards0") {
                    //   tabs.selected++;
                    //   pages.selected++;
                    // } else {
                    document.querySelector('#discard').appendChild(e.target); // adds this card to the discard pile of step 1
                    // wait for 50ms so the animations can kick in
                    setTimeout(function() {
                        e.target.style.opacity = 1; // set opacity back to 1 (default)
                        // set it's position and location back to default (and in webkit-based browsers)
                        e.target.style.transform = "translate3d(0px, 0px, 0px) rotate(0deg)";
                        e.target.style.webkitTransform = "translate3d(0px, 0px, 0px) rotate(0deg)";
                    }, 10);
                }
                if (document.querySelector('#discard').children.length == 7) {
                    setTimeout(function() {
                        document.querySelector('#fab-1').removeAttribute('hidden');
                    }, 800);
                    setTimeout(function() {
                        document.querySelector('#fab-1').setAttribute('showing', true);
                    }, 900);
                }
            }
        });
    }

    document.querySelector('#discard').addEventListener('swipeable-card-swipe-away', function(e) {
        // give the system 10 seconds to make sure the animation completed and the card doesn't get swiped twice
        setTimeout(function() {
            e.target.swiped = false;
        }, 10);

        if (!e.target.swiped) {
            e.target.parentNode.removeChild(e.target); // removes this card

            // find the deck with the least cards
            var smallestDeck = decks[4].children.length;
            var smallestDeckId = decks[4].id;
            var y = 4;
            while (y < 8) {
                if ((decks[y].id.indexOf("cards")) == 0) {
                    if (decks[y].children.length < smallestDeck) {
                        smallestDeck = decks[y].children.length;
                        smallestDeckId = decks[y].id;
                    }
                }
                y++;
            }

            document.querySelector('#' + smallestDeckId).appendChild(e.target); // adds this card to the deck with least cards

            setTimeout(function() {
                e.target.style.opacity = 1; // set opacity back to 1 (default)
                // set it's position and location back to default (and in webkit-based browsers)
                e.target.style.transform = "translate3d(0px, 0px, 0px) rotate(0deg)";
                e.target.style.webkitTransform = "translate3d(0px, 0px, 0px) rotate(0deg)";
            }, 1);
        }
    });

    document.querySelector('#intro').addEventListener('swipeable-card-swipe-away', function(e) {
        e.target.parentNode.removeChild(e.target);
        tabs.selected++;
        pages.selected++;
    });

    function showDialog(dialog) {
        document.querySelector('#' + dialog).toggle();
    }

    // bring the cards that were not discarded into the next page
    function next() {
      console.log('got here');
        tabs.selected++;
        pages.selected++;
        var z = 4;
        while (z <= 7) {
          console.log("child = " + decks[z].children);
          if (decks[z].children.length > 1) {
            var a = 1;
            while (a <= decks[z].children.length) {
              document.querySelector('being-choice-' + z).innerText = decks[z].children[a].innerText;
            }
          }
          
        }
    }

    // drag-drop script

    addEventListener('drag-start', function(e) {
        console.log(e.detail);
        var dragInfo = e.detail;
        // flaw #2: e vs dragInfo.event
        var color = dragInfo.event.target.style.backgroundColor;

        // currentNode contains the id of the element containing the card data
        if (dragInfo.event.target.id == "") {
            var currentNode = dragInfo.event.target.parentNode.id;
        } else if (dragInfo.event.target.parentNode.id == "") {
            var currentNode = dragInfo.event.target.id;
        }
        // get the card data text whether the user clicks the text or the card
        if (dragInfo.event.target.parentNode.id == currentNode) {
            var content = dragInfo.event.target.parentNode.innerText;
        } else {
            var content = dragInfo.event.target.innerText;
        }
        dragInfo.avatar.style.cssText = 'width: 240px; height: auto; border-radius: 2px;margin: 20px auto; padding: 30px; background-color:white;box-shadow: 0px 2px 5px #ccc;color:#333; text-overflow: ellipsis; cursor: pointer';
        var node = document.createTextNode(content);
        e.detail.avatar.innerText = "";
        e.detail.avatar.appendChild(node);
        dragInfo.drag = function() {};
        dragInfo.drop = drop;
    });
    //
    function drop(dragInfo) {
        // var color = dragInfo.avatar.style.borderColor;
        // currentNode contains the id of the element containing the card data
        if (dragInfo.event.target.id == "") {
            var currentNode = dragInfo.event.target.parentNode.id;
        } else if (dragInfo.event.target.parentNode.id == "") {
            var currentNode = dragInfo.event.target.id;
        }
        // get the card data text whether the user clicks the text or the card
        if (dragInfo.event.target.parentNode.id == currentNode) {
            var content = dragInfo.event.target.parentNode.innerText;
        } else {
            var content = dragInfo.event.target.innerText;
        }
        var color = dragInfo.avatar.style.color;
        var altColor = dragInfo.avatar.style.backgroundColor;
        var dropTarget = dragInfo.event.relatedTarget;
        if (color && dropTarget.id === 'drop') {
            var f = dragInfo.framed;
            var d = document.createElement('div');
            d.className = 'dropped';
            d.style.left = f.x - 4 + 'px';
            d.style.top = f.y - 4 + 'px';
            d.style.backgroundColor = color;
            dropTarget.appendChild(d);
            dropTarget.style.backgroundColor = altColor;
            // check if card has already been dropped anywhere else
            // remove card if it has been dropped somewhere else
            var x = 0;
            while (x < document.querySelectorAll('#drop').length) {
                if (document.querySelectorAll('#drop')[x].innerText == content) {
                    document.querySelectorAll('#drop')[x].innerText = "";
                }
                x++;
            }
            if (dropTarget.innerText == content) {
                // console.log('already used!');
            }
            dropTarget.innerText = content;
        }
    }
    </script>

</body>

</html>